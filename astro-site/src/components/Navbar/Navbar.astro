---
import { Image } from 'astro:assets';
import logoImage from '../../assets/images/logo.png';
import DarkModeSwitch from './DarkModeSwitch';
import { useTranslations, getAlternateLangPath, type Lang } from '../../i18n';

interface Props {
  lang: Lang;
  currentPath: string;
}

const { lang, currentPath } = Astro.props;
const t = useTranslations(lang);

const navigation = [
  { name: t('Home'), to: lang === 'en' ? '/' : '/pl/' },
  { name: t('About'), to: lang === 'en' ? '/about/' : '/pl/about/' },
  { name: t('Mentoring'), to: lang === 'en' ? '/mentoring/' : '/pl/mentoring/' },
  { name: t('Courses'), to: lang === 'en' ? '/courses/' : '/pl/courses/' },
  { name: t('Blog'), to: lang === 'en' ? '/blog/' : '/pl/blog/' },
  { name: t('Songs'), to: lang === 'en' ? '/songs/' : '/pl/songs/' },
];

// Get alternate language path for language switcher
const enPath = lang === 'en' ? currentPath : getAlternateLangPath(currentPath, lang, 'en');
const plPath = lang === 'pl' ? currentPath : getAlternateLangPath(currentPath, lang, 'pl');
---

<div class="flex flex-col border-b md:border-b-0 border-gray-400 sticky md:relative top-0 left-0 w-full z-30 md:max-w-6xl bg-white dark:bg-black mr-10 lg:text-lg">
  <!-- Mobile header -->
  <div class="flex items-center justify-end ml-4">
    <div class="flex gap-3 md:hidden">
      <Image src={logoImage} alt="logo" width={24} height={24} />
      <a href={lang === 'en' ? '/' : '/pl/'}>korczak.xyz</a>
    </div>
    <div class="grow md:hidden"></div>
    <DarkModeSwitch className="block md:hidden" client:load />
    <button
      class="flex md:hidden"
      aria-label="Menu"
      id="menu-button"
    >
      <svg class="block md:hidden cursor-pointer text-3xl my-6 mx-4 w-8 h-8" fill="currentColor" viewBox="0 0 512 512">
        <path d="M61.1 224C45 224 32 211 32 194.9c0-1.9 .2-3.7 .6-5.6C37.9 168.3 78.8 32 256 32s218.1 136.3 223.4 157.3c.5 1.9 .6 3.7 .6 5.6c0 16.1-13 29.1-29.1 29.1L61.1 224zM144 128a16 16 0 1 0 -32 0 16 16 0 1 0 32 0zm240 16a16 16 0 1 0 0-32 16 16 0 1 0 0 32zM272 96a16 16 0 1 0 -32 0 16 16 0 1 0 32 0zM16 304c0-26.5 21.5-48 48-48l384 0c26.5 0 48 21.5 48 48s-21.5 48-48 48L64 352c-26.5 0-48-21.5-48-48zm16 96c0-8.8 7.2-16 16-16l416 0c8.8 0 16 7.2 16 16l0 16c0 35.3-28.7 64-64 64L96 480c-35.3 0-64-28.7-64-64l0-16z"/>
      </svg>
    </button>
  </div>

  <!-- Desktop nav / Mobile dropdown -->
  <nav id="main-nav" class="items-end md:items-center gap-4 ml-6 mr-6 md:mr-0 md:mt-4 mb-6 flex-col md:flex md:flex-row hidden md:flex">
    <div class="flex gap-3 md:flex hidden">
      <Image src={logoImage} alt="logo" width={24} height={24} />
      <a href={lang === 'en' ? '/' : '/pl/'}>korczak.xyz</a>
    </div>
    <div class="grow hidden md:block"></div>
    {navigation.map(item => (
      <a href={item.to}>{item.name}</a>
    ))}
    <DarkModeSwitch className="hidden md:block" client:load />
    <div class="flex gap-3">
      <a href={enPath}>
        <span role="img" aria-label="en" class="text-2xl">ðŸ‡¬ðŸ‡§</span>
      </a>
      <a href={plPath}>
        <span role="img" aria-label="pl" class="text-2xl">ðŸ‡µðŸ‡±</span>
      </a>
    </div>
  </nav>
</div>

<script>
  const menuButton = document.getElementById('menu-button');
  const mainNav = document.getElementById('main-nav');

  menuButton?.addEventListener('click', () => {
    mainNav?.classList.toggle('hidden');
    mainNav?.classList.toggle('flex');
  });
</script>
