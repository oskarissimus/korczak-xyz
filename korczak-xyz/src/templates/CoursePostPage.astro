---
import { getCollection, render } from 'astro:content';
import type { ImageMetadata } from 'astro';
import Layout from '../layouts/Layout.astro';
import PageContent from '../components/PageContent.astro';
import TechIconsGrid from '../components/TechIconsGrid.astro';
import '../styles/course.css';
import { type Lang } from '../i18n';

// Import tech icons
import jsIcon from '../assets/images/js-pixel.png';
import tsIcon from '../assets/images/ts-pixel.png';
import nodejsIcon from '../assets/images/nodejs-pixel.png';
import globeIcon from '../assets/images/globe-pixel.png';
import lockIcon from '../assets/images/lock-pixel.png';
import serverIcon from '../assets/images/server-pixel.png';
import cableIcon from '../assets/images/cable-pixel.png';
import postmanIcon from '../assets/images/postman-pixel.png';
import pythonIcon from '../assets/images/python-pixel.png';
import chromeIcon from '../assets/images/chrome-pixel.png';
import seleniumIcon from '../assets/images/selenium-pixel.png';

interface Props {
  lang: Lang;
  slug: string;
}

const { lang, slug } = Astro.props;

// Define tech icons for each course by slug
const courseIcons: Record<string, Array<{ icon: ImageMetadata; label: string }>> = {
  'backend-javascript': [
    { icon: jsIcon, label: 'JavaScript' },
    { icon: tsIcon, label: 'TypeScript' },
    { icon: nodejsIcon, label: 'Node.js' },
  ],
  'selected-network-aspects': [
    { icon: globeIcon, label: 'Internet' },
    { icon: lockIcon, label: 'Security' },
    { icon: serverIcon, label: 'Server' },
    { icon: cableIcon, label: 'Network' },
  ],
  'advanced-web-testing-tools': [
    { icon: postmanIcon, label: 'Postman' },
    { icon: pythonIcon, label: 'Python' },
    { icon: chromeIcon, label: 'Chrome' },
    { icon: seleniumIcon, label: 'Selenium' },
  ],
};

const collectionName = `courses-${lang}` as 'courses-en' | 'courses-pl';
const courses = await getCollection(collectionName, ({ data }) =>
  data.published && data.slug === slug
);

if (courses.length === 0) {
  return Astro.redirect('/404');
}

const course = courses[0];
const { Content } = await render(course);
const techIcons = courseIcons[course.data.slug];
---

<Layout title={`${course.data.title} | korczak.xyz`} lang={lang}>
  <PageContent title={course.data.title}>
    {techIcons && techIcons.length > 0 && (
      <div class="course-icons-wrapper">
        <TechIconsGrid icons={techIcons} />
      </div>
    )}
    <section class="course" itemprop="articleBody">
      <Content />
    </section>
  </PageContent>
</Layout>

<style>
  .course-icons-wrapper {
    border: 3px inset var(--retro-dark-gray);
    background: var(--retro-teal);
    padding: 15px;
    margin-bottom: 20px;
  }
</style>
