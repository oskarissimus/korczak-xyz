---
import { getCollection, render } from 'astro:content';
import { Image } from 'astro:assets';
import Layout from '../layouts/Layout.astro';
import PageContent from '../components/PageContent.astro';
import '../styles/course.css';
import { type Lang } from '../i18n';

interface Props {
  lang: Lang;
  slug: string;
}

const { lang, slug } = Astro.props;

const collectionName = `courses-${lang}` as 'courses-en' | 'courses-pl';
const courses = await getCollection(collectionName, ({ data }) =>
  data.published && data.slug === slug
);

if (courses.length === 0) {
  return Astro.redirect('/404');
}

const course = courses[0];
const { Content } = await render(course);
---

<Layout title={`${course.data.title} | korczak.xyz`} lang={lang}>
  <PageContent title={course.data.title}>
    {course.data.featuredImageColor && (
      <Image
        src={course.data.featuredImageColor}
        alt={course.data.title}
        width={800}
        class="course-image-color block dark:hidden"
      />
    )}
    {course.data.featuredImageBW && (
      <Image
        src={course.data.featuredImageBW}
        alt={course.data.title}
        width={800}
        class="course-image-bw hidden dark:block"
      />
    )}
    <section class="course" itemprop="articleBody">
      <Content />
    </section>
  </PageContent>
</Layout>
