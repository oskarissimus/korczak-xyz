---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
  slug: string;
  title: string;
  date: Date;
  excerpt?: string;
  featuredImage?: ImageMetadata;
  lang: string;
}

const { slug, title, date, excerpt, featuredImage, lang } = Astro.props;

function formatDate(date: Date, locale: string): string {
  const localeMap: Record<string, string> = {
    'en': 'en-US',
    'pl': 'pl-PL'
  };
  return date.toLocaleDateString(localeMap[locale] || locale);
}

const href = lang === 'en' ? `/blog/${slug}/` : `/pl/blog/${slug}/`;

// Check if post is recent (within last 30 days)
const isRecent = (new Date().getTime() - date.getTime()) < (30 * 24 * 60 * 60 * 1000);
---

<li class="blog-item">
  <a href={href} class="blog-link">
    <div class="blog-item-header">
      <span class="blog-icon">#</span>
      <h2 class="blog-title">{title}</h2>
      {isRecent && <span class="blink new-badge">NEW!</span>}
    </div>
    <div class="blog-item-content">
      {featuredImage && (
        <div class="blog-image-frame">
          <Image
            src={featuredImage}
            alt={title || "Post's featured image"}
            width={120}
            height={80}
            class="blog-image"
          />
        </div>
      )}
      <div class="blog-text">
        {excerpt && <p class="blog-excerpt">{excerpt}</p>}
        <span class="blog-date">[{formatDate(date, lang)}]</span>
      </div>
    </div>
  </a>
</li>

<style>
  .blog-item {
    list-style: none;
  }

  .blog-link {
    display: block;
    background: var(--retro-gray);
    border: 3px outset var(--retro-white);
    padding: 15px;
    text-decoration: none;
    color: inherit;
  }

  .blog-link:hover {
    background: #a0a0a0;
  }

  .blog-link:active {
    border-style: inset;
  }

  .blog-item-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .blog-icon {
    background: var(--retro-teal);
    color: var(--retro-yellow);
    padding: 5px 10px;
    border: 2px inset var(--retro-dark-gray);
    font-weight: bold;
  }

  .blog-title {
    font-family: 'VT323', monospace;
    font-size: 1.4rem;
    flex-grow: 1;
    color: var(--retro-navy);
  }

  .blog-link:hover .blog-title {
    text-decoration: underline;
  }

  .new-badge {
    background: var(--retro-red);
    color: var(--retro-white);
    padding: 3px 8px;
    font-size: 0.9rem;
    font-weight: bold;
  }

  .blog-item-content {
    display: flex;
    gap: 15px;
    align-items: flex-start;
  }

  .blog-image-frame {
    flex-shrink: 0;
    width: 120px;
    height: 80px;
    overflow: hidden;
    border: 3px inset var(--retro-dark-gray);
  }

  .blog-image-frame img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    max-width: none;
    border: none;
  }

  .blog-text {
    flex-grow: 1;
  }

  .blog-excerpt {
    color: var(--retro-black);
    margin-bottom: 8px;
    font-size: 1.1rem;
  }

  .blog-date {
    color: var(--retro-teal);
    font-size: 1rem;
  }

  @media (max-width: 600px) {
    .blog-item-content {
      flex-direction: column;
    }

    .blog-image-frame {
      width: 100%;
      height: auto;
      aspect-ratio: 120 / 80;
    }
  }
</style>
