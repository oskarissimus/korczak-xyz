---
import type { Lang } from '../i18n';
import { execSync } from 'child_process';

interface Props {
  lang?: Lang;
}

const { lang = 'en' } = Astro.props;
const homeLink = lang === 'en' ? '/' : '/pl/';

// Build-time info (runs at build, not in browser)
const commitHash = execSync('git rev-parse --short HEAD').toString().trim();
const buildTimestamp = new Date().toISOString();
---

<footer class="retro-footer">
  <div class="marquee-container">
    <div class="marquee-text">
      *** Welcome to korczak.xyz! *** 7 years of coding experience *** Python, JavaScript, Docker, Kubernetes *** Contact me for mentoring! *** Best viewed in Netscape Navigator 4.0 ***
    </div>
  </div>

  <div class="under-construction">
    <div class="construction-gif"></div>
    <span class="construction-text">Under Construction - <a href={homeLink}>korczak.xyz</a> - Est. 2024</span>
    <div class="construction-gif"></div>
  </div>

  <div class="footer-counter">
    <div class="visitor-counter">
      <span>Visitors: 1337420</span>
    </div>
  </div>

  <div class="build-info">
    <span><a href={`https://github.com/oskarissimus/korczak-xyz/commit/${commitHash}`} target="_blank" rel="noopener">{commitHash}</a> | <span id="build-time" data-timestamp={buildTimestamp}>{buildTimestamp}</span></span>
  </div>
</footer>

<script>
  const buildTimeEl = document.getElementById('build-time');
  if (buildTimeEl) {
    const timestamp = buildTimeEl.dataset.timestamp;
    if (timestamp) {
      const date = new Date(timestamp);
      const lang = document.documentElement.lang || 'en';
      const locale = lang === 'pl' ? 'pl-PL' : 'en-US';
      buildTimeEl.textContent = date.toLocaleString(locale, {
        month: 'short',
        day: 'numeric',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
      });
    }
  }
</script>

<style>
  .retro-footer {
    margin-top: 30px;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .construction-text {
    color: var(--retro-yellow);
    font-size: 1rem;
    text-align: center;
  }

  .construction-text a {
    color: var(--retro-cyan);
  }

  .footer-counter {
    display: flex;
    justify-content: center;
    margin-top: 10px;
  }

  .build-info {
    text-align: center;
    font-size: 0.75rem;
    color: var(--retro-gray, #666);
    margin-top: 5px;
  }

  .build-info a {
    color: var(--retro-cyan);
  }
</style>
