---
import { Image } from 'astro:assets';

export interface Props {
  names: string[];
  dir: string;
}

const { names, dir } = Astro.props;

// Helper to convert kebab-case to Title Case
function nameToAlt(name: string): string {
  const replaced = name.replace(/-/g, ' ');
  return replaced.charAt(0).toUpperCase() + replaced.slice(1);
}

// Import all images from blog directories
const allImages = import.meta.glob<{ default: ImageMetadata }>(
  '../assets/images/blog/**/*.{jpg,jpeg,png,gif,webp}',
  { eager: true }
);

// Filter and order images based on names prop
const images = names.map((name) => {
  const imagePath = Object.keys(allImages).find((path) => {
    const pathParts = path.split('/');
    const fileName = pathParts[pathParts.length - 1];
    const fileDir = pathParts[pathParts.length - 2];
    return fileDir === dir && fileName.startsWith(name + '.');
  });

  if (!imagePath) {
    console.warn(`Gallery: Could not find image "${name}" in directory "${dir}"`);
    return null;
  }

  return {
    image: allImages[imagePath].default,
    alt: nameToAlt(name),
    name,
  };
}).filter(Boolean);
---

<div style="display: flex; gap: 20px; flex-wrap: wrap;">
  {images.map((item) => item && (
    <div style="flex-grow: 1;">
      <Image
        src={item.image}
        alt={item.alt}
        width={300}
        style="display: block; width: 100%; height: auto;"
      />
      {item.alt}
    </div>
  ))}
</div>
