---
import { type Lang, getLocalizedPath } from '../i18n';

interface Props {
  slug: string;
  title: string;
  author: string;
  dateAdded: Date;
  videoUploadDate?: Date;
  lang?: Lang;
}

const { slug, title, author, dateAdded, videoUploadDate, lang = 'pl' } = Astro.props;

// Use the earlier of the two dates
const displayDate = videoUploadDate && videoUploadDate < dateAdded ? videoUploadDate : dateAdded;
const songUrl = getLocalizedPath(`/songs/${slug}/`, lang);

function formatDate(date: Date, locale: string): string {
  const localeMap: Record<string, string> = {
    'en': 'en-US',
    'pl': 'pl-PL'
  };
  return date.toLocaleDateString(localeMap[locale] || locale);
}
---

<li class="song-item">
  <a href={songUrl} class="song-link">
    <span class="song-icon">*</span>
    <div class="song-info">
      <h2 class="song-title">{title}</h2>
      <div class="song-meta">
        <span class="song-date">{formatDate(displayDate, lang)}</span>
        <span class="song-author">[{author}]</span>
      </div>
    </div>
  </a>
</li>

<style>
  .song-item {
    list-style: none;
  }

  .song-link {
    display: flex;
    align-items: center;
    gap: 15px;
    background: var(--retro-gray);
    border: 3px outset var(--retro-white);
    padding: 12px 15px;
    text-decoration: none;
    color: inherit;
  }

  .song-link:hover {
    background: #a0a0a0;
  }

  .song-link:active {
    border-style: inset;
  }

  .song-icon {
    background: var(--retro-magenta);
    color: var(--retro-white);
    padding: 5px 10px;
    border: 2px inset var(--retro-dark-gray);
    font-weight: bold;
    font-size: 1.2rem;
  }

  .song-info {
    display: flex;
    flex-direction: column;
    gap: 3px;
  }

  .song-title {
    font-family: 'VT323', monospace;
    font-size: 1.3rem;
    margin: 0;
    color: var(--retro-navy);
  }

  .song-link:hover .song-title {
    text-decoration: underline;
  }

  .song-meta {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .song-author {
    color: var(--retro-teal);
    font-size: 1rem;
  }

  .song-date {
    color: var(--retro-navy);
    font-size: 0.9rem;
  }

  @media (max-width: 600px) {
    .song-link {
      padding: 10px 12px;
    }

    .song-title {
      font-size: 1.1rem;
    }
  }
</style>
